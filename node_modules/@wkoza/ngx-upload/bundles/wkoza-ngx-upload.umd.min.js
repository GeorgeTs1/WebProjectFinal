!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/common/http"),require("@angular/core"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define("@wkoza/ngx-upload",["exports","rxjs","@angular/common/http","@angular/core","@angular/forms","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).wkoza=e.wkoza||{},e.wkoza["ngx-upload"]={}),e.rxjs,e.ng.common.http,e.ng.core,e.ng.forms,e.ng.common)}(this,(function(e,t,r,o,n,i){"use strict";var s=function(){function e(e,t,r,o){this.file=e,this.uploadService=t,this.logger=r,this.disableMultipart=o,this.isReady=!0,this.progress=0,this.formData=new FormData,this.alias="file"}return e.prototype.upload=function(e,t){e?this.uploadService.uploadFileItem(this,e,t):this.logger.error("You must define a UploadEndPoint object.")},e.prototype.cancel=function(){this.logger.debug("upload cancel"),this.uploadInProgress&&(this.ɵonCancel(),this.uploadService.cancelFileItem(this))},e.prototype.remove=function(){this.logger.debug("upload remove"),this.uploadService.removeFromQueue(this)},e.prototype.ɵonBeforeUploadItem=function(){this.isReady=!0,this.uploadInProgress=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0},e.prototype.ɵonProgress=function(e){this.isReady=!1,this.progress=e},e.prototype.ɵonSuccess=function(){this.isReady=!1,this.uploadInProgress=!1,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100},e.prototype.ɵonError=function(){this.isReady=!1,this.uploadInProgress=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0},e.prototype.ɵonCancel=function(){this.isReady=!0,this.uploadInProgress=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.sub.unsubscribe()},e}();
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var u=function(){},c=function(){},h=function(){function e(e,t){void 0===t&&(t=!0),this._console=e,this._debugEnabled=t}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._invokeConsoleMethod("log",e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._invokeConsoleMethod("info",e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._invokeConsoleMethod("warn",e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._invokeConsoleMethod("error",e)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._debugEnabled&&this._invokeConsoleMethod("debug",e)},e.prototype._invokeConsoleMethod=function(e,t){var r=this._console[e]||this._console.log||c;r.apply||(r=Function.prototype.bind.call(r,this._console)),r.apply(this._console,t)},e}(),d=function(){function e(){}return e.prototype.log=function(){},e.prototype.info=function(){},e.prototype.warn=function(){},e.prototype.error=function(){},e.prototype.debug=function(){},e}(),f=function(){function e(e,r){this.logger=e,this.httpClient=r,this.progressTotal=0,this.onCancel$=new t.Subject,this.onError$=new t.Subject,this.onDropError$=new t.Subject,this.onSuccess$=new t.Subject,this.onBeforeUploadItem$=new t.Subject,this.onProgress$=new t.Subject,this.onAddToQueue$=new t.Subject,this.queue=new Array,this.headers=new Map}return e.prototype.addToQueue=function(e,t,r){if(this.logger.info("add to queue"),r&&!r.multiple&&e.length>1)return this.logger.error("there is more than one file."),void this.onDropError$.next({errorAccept:!1,errorMultiple:!0});for(var o=function(o){var i,a=e.item(o);if((n.logger.debug(e.item(o)),r&&r.accept)&&!r.accept.some((function(e){return e.indexOf("/*")>-1?e.split("/")[0]===a.type.split("/")[0]:"*"===e||e===a.type})))return n.logger.error("this file is not accepted because of its type",a),n.onDropError$.next({item:a,errorAccept:!0,errorMultiple:!1}),"continue";r&&r.disableMultipart?i=new s(a,n,n.logger,!0):(i=new s(a,n,n.logger,!1),t&&Object.keys(t.controls).forEach((function(e){i.formData.append(e,t.get(e).value)}))),n.queue.push(i),n.onAddToQueue$.next(i)},n=this,i=0;i<e.length;i++)o(i)},e.prototype.uploadFileItem=function(e,t,o){var n=this;void 0===o&&(o={}),this.logger.info("enter uploadService.uploadFileItem()");var i=t.method,s=t.url,a=this.queue.indexOf(e),l=this.queue[a];if(this.onBeforeUploadItem(l),!l.isCancel){var p;l.uploadInProgress=!0,e.disableMultipart?p=l.file:(p=l.formData).append(l.alias,l.file,l.file.name);var u=new r.HttpRequest(i,s,p,Object.assign(o,{reportProgress:!0}));e.sub=this.httpClient.request(u).subscribe((function(t){if(t.type===r.HttpEventType.UploadProgress){var o=Math.round(100*t.loaded/(t.total?t.total:t.loaded));n.logger.debug("File is "+o+"% uploaded."),e.ɵonProgress(o),n.onProgressItem(l,o)}else t instanceof r.HttpResponse&&(e.ɵonSuccess(),n.onSuccess(l,t.body,t.status,t.headers))}),(function(e){e instanceof r.HttpErrorResponse&&("ngx_upload_mock"===s?(l.ɵonSuccess(),n.onSuccess(l,e.message,e.status,e.headers)):e.error instanceof Error?(l.ɵonError(),n.onError(l,e.error.message,e.status,e.headers)):(l.ɵonError(),n.onError(l,e.error,e.status,e.headers)))}))}},e.prototype.cancelFileItem=function(e){this.progressTotal=this.computeTotalProgress(),this.onCancel$.next(e)},e.prototype.uploadAll=function(e,t){var r,o,n=this.queue.filter((function(e){return e.isReady}));if(n.length)try{for(var i=a(n),s=i.next();!s.done;s=i.next()){s.value.upload(e,t)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.cancelAll=function(){var e,t,r=this.queue.filter((function(e){return e.uploadInProgress}));if(r.length){try{for(var o=a(r),n=o.next();!n.done;n=o.next()){n.value.cancel()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.progressTotal=this.computeTotalProgress()}},e.prototype.removeAllFromQueue=function(){var e,t,r=this.queue.filter((function(e){return!e.uploadInProgress&&!e.isSuccess}));if(r.length)try{for(var o=a(r),n=o.next();!n.done;n=o.next()){var i=n.value;this.removeFromQueue(i)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.removeFromQueue=function(e){var t=this.queue.indexOf(e),r=this.queue[t];r.uploadInProgress&&r.cancel(),this.queue.splice(t,1),this.progressTotal=this.computeTotalProgress()},e.prototype.computeTotalProgress=function(){var e,t,r=0,o=0;try{for(var n=a(this.queue),i=n.next();!i.done;i=n.next()){var s=i.value;(s.uploadInProgress||s.isSuccess)&&(r+=s.file.size/100*s.progress||0,o+=s.file.size,this.logger.debug(r+" / "+o))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return Math.round(100*r/o)},e.prototype.onBeforeUploadItem=function(e){this.logger.info("enter uploadService.ɵonBeforeUploadItem()"),e.ɵonBeforeUploadItem(),this.onBeforeUploadItem$.next(e)},e.prototype.onProgressItem=function(e,t){this.logger.info("call onProgressItem "+e+" "+t),this.progressTotal=this.computeTotalProgress(),e.ɵonProgress(t),this.onProgress$.next({item:e,progress:t})},e.prototype.onError=function(e,t,r,o){this.logger.info("call onError "+e+" "+t+" "+r+" "+o),e.ɵonError(),this.onError$.next({item:e,body:t,status:r,headers:o})},e.prototype.onSuccess=function(e,t,r,o){this.logger.info("call onSuccess "+e+" "+t+" "+r+" "+o),this.progressTotal=this.computeTotalProgress(),e.ɵonSuccess(),this.onSuccess$.next({item:e,body:t,status:r,headers:o})},e}();f.ɵprov=o.ɵɵdefineInjectable({factory:function(){return new f(o.ɵɵinject(u),o.ɵɵinject(r.HttpClient))},token:f,providedIn:"root"}),f.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],f.ctorParameters=function(){return[{type:u},{type:r.HttpClient}]};var g=new o.InjectionToken("Ngx drop Zone Options"),m=new o.InjectionToken("Ngx Logger Options"),y={color:"",colorDrag:"",colorDrop:"",multiple:!0,disableMultipart:!1},v={enabled:!1,debug:!0},b={multiple:!0,disableMultipart:!1},I=function(){function e(e,t,r,o,n,s,a,l,p){var u=this;this.el=e,this.renderer=t,this.injector=r,this.logger=o,this.uploader=n,this.dropOptions=s,this.ngForm=a,this.formGroupDirective=l,this.ngForm?this.formGroup=a.form:this.formGroupDirective?this.formGroup=l.form:this.formGroup=null,i.isPlatformBrowser(p)&&(this.renderer.listen(e.nativeElement,"dragleave",(function(e){return u.onDragLeave(e)})),this.renderer.listen(e.nativeElement,"drop",(function(e){return u.dropEvent(e)})),this.renderer.listen(e.nativeElement,"dragover",(function(e){return u.onDragOver(e)})))}return Object.defineProperty(e.prototype,"ngxDragAndDrop",{set:function(e){e&&(this.logger.debug(JSON.stringify(e)),this.dropOptions=e)},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.renderer.addClass(this.el.nativeElement,this.dropOptions.color)},e.prototype.onDragLeave=function(e){this.logger.debug("dragleave event"),this.renderer.removeClass(this.el.nativeElement,this.dropOptions.colorDrag),this.renderer.removeClass(this.el.nativeElement,this.dropOptions.colorDrop),this.renderer.addClass(this.el.nativeElement,this.dropOptions.color),this.stopAndPrevent(e)},e.prototype.dropEvent=function(e){this.logger.debug("drop event"),this.renderer.removeClass(this.el.nativeElement,this.dropOptions.color),this.renderer.removeClass(this.el.nativeElement,this.dropOptions.colorDrag),this.renderer.addClass(this.el.nativeElement,this.dropOptions.colorDrop);var t=this.getTransfer(e);t&&(t.dropEffect="copy",this.stopAndPrevent(e),this.uploader.addToQueue(t.files,this.formGroup,this.dropOptions))},e.prototype.onDragOver=function(e){this.logger.debug("dragover event"),this.renderer.removeClass(this.el.nativeElement,this.dropOptions.color),this.renderer.removeClass(this.el.nativeElement,this.dropOptions.colorDrop),this.renderer.addClass(this.el.nativeElement,this.dropOptions.colorDrag);var t=this.getTransfer(e);this.haveFiles(t.types)&&this.stopAndPrevent(e)},e.prototype.stopAndPrevent=function(e){e.stopPropagation(),e.preventDefault()},e.prototype.getTransfer=function(e){return e.dataTransfer?e.dataTransfer:e.originalEvent.dataTransfer},e.prototype.haveFiles=function(e){return!!e&&(e.indexOf?-1!==e.indexOf("Files"):!!e.contains&&e.contains("Files"))},e}();I.decorators=[{type:o.Directive,args:[{selector:"[ngxDragAndDrop]",exportAs:"ngxDragAndDrop"}]}],I.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.Injector},{type:u},{type:f},{type:void 0,decorators:[{type:o.Inject,args:[g]}]},{type:n.NgForm,decorators:[{type:o.Optional}]},{type:n.FormGroupDirective,decorators:[{type:o.Optional}]},{type:Object,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},I.propDecorators={ngxDragAndDrop:[{type:o.Input}]};var w=function(){function e(e,t){this.renderer=e,this.el=t}return e.prototype.ngOnInit=function(){var e=this;if(0===this.fileItem.file.type.indexOf("image/jpeg")||0===this.fileItem.file.type.indexOf("image/png")){var t=this.renderer.createElement("img");this.renderer.appendChild(this.el.nativeElement,t),this.renderer.setStyle(t,"width","100%"),this.renderer.setStyle(t,"height","100%"),this._getOrientation(this.fileItem.file,(function(r){var o=new Image,n=new FileReader;n.onload=function(n){o.onload=function(){var n=o.width,i=o.height,s=document.createElement("canvas"),a=s.getContext("2d");switch(s.width=n,s.height=i,a.drawImage(o,0,0),r){case 2:a.transform(-1,0,0,1,n,0);break;case 3:a.transform(-1,0,0,-1,n,i);break;case 4:a.transform(1,0,0,-1,0,i);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,i,0);break;case 7:a.transform(0,-1,-1,0,i,n);break;case 8:a.transform(0,-1,1,0,0,n)}e.renderer.setProperty(t,"src",s.toDataURL())},o.src=n.target.result},n.readAsDataURL(e.fileItem.file)}))}},e.prototype._getOrientation=function(e,t){var r=new FileReader;r.onload=function(e){var r=new DataView(e.target.result);if(65496!==r.getUint16(0,!1))return t(-2);for(var o=r.byteLength,n=2;n<o;){var i=r.getUint16(n,!1);if(n+=2,65505===i){if(1165519206!==r.getUint32(n+=2,!1))return t(-1);var s=18761===r.getUint16(n+=6,!1);n+=r.getUint32(n+4,s);var a=r.getUint16(n,s);n+=2;for(var l=0;l<a;l++)if(274===r.getUint16(n+12*l,s))return t(r.getUint16(n+12*l+8,s))}else{if(65280!=(65280&i))break;n+=r.getUint16(n,!1)}}return t(-1)},r.readAsArrayBuffer(e.slice(0,65536))},e}();w.decorators=[{type:o.Directive,args:[{selector:"[ngxThumbnail]",exportAs:"ngxThumbnail"}]}],w.ctorParameters=function(){return[{type:o.Renderer2},{type:o.ElementRef}]},w.propDecorators={fileItem:[{type:o.Input,args:["ngxThumbnail"]}]};var x=function(){function e(e,t,r,o,n){this.injector=e,this.uploader=t,this.renderer=r,this.ngForm=o,this.formGroupDirective=n,this.files=new Set,this.ngForm?this.formGroup=o.form:this.formGroupDirective?this.formGroup=n.form:this.formGroup=null}return e.prototype.onFilesAdded=function(){this.uploader.addToQueue(this.file.nativeElement.files,this.formGroup,this.options),this.file.nativeElement.value=""},e.prototype.ngAfterViewInit=function(){!1!==this.options.multiple&&this.renderer.setProperty(this.file.nativeElement,"multiple","multiple"),this.options.accept&&this.renderer.setProperty(this.file.nativeElement,"accept",this.options.accept.join()),this.options.capture&&this.renderer.setProperty(this.file.nativeElement,"capture",this.options.capture)},e}();x.decorators=[{type:o.Component,args:[{selector:"ngx-upload-inputfile",template:'\n      <label class="input-file">\n          <input type="file" #file (change)="onFilesAdded()">\n          <ng-content></ng-content>\n      </label>',styles:['input[type="file"] { display: none; } .input-file { width: 100%; }']}]}],x.ctorParameters=function(){return[{type:o.Injector},{type:f},{type:o.Renderer2},{type:n.NgForm,decorators:[{type:o.Optional}]},{type:n.FormGroupDirective,decorators:[{type:o.Optional}]}]},x.propDecorators={file:[{type:o.ViewChild,args:["file",{static:!0}]}]};var E=function(){function e(e,t,r,o){this.resolver=e,this.injector=t,this.vcRef=r,this.templateRef=o}return e.prototype.ngOnInit=function(){var e=this.templateRef.createEmbeddedView(null),t=this.resolver.resolveComponentFactory(x);this.vcRef.createComponent(t,0,this.injector,[e.rootNodes]).instance.options=this.ngxInputFile?this.ngxInputFile:b,e.detectChanges()},e}();E.decorators=[{type:o.Directive,args:[{selector:"[ngxInputFile]"}]}],E.ctorParameters=function(){return[{type:o.ComponentFactoryResolver},{type:o.Injector},{type:o.ViewContainerRef},{type:o.TemplateRef}]},E.propDecorators={ngxInputFile:[{type:o.Input}]};var D=[I,w,x,E];function P(e){if(e.enabled?e.enabled:o.isDevMode()){var t="object"==typeof console?console:{},r=!e.debug||e.debug;return new h(t,r)}return new d}var O=new o.InjectionToken("Internal forRoot Guard");function S(e){if(e)throw new TypeError("NgxUploadModule.forRoot() is called twice.");return"guarded"}var C=function(){function e(){}return e.forRoot=function(t,r){return{ngModule:e,providers:[{provide:m,useValue:r||v},{provide:g,useValue:t||y},{provide:u,useFactory:P,deps:[m]},{provide:O,useFactory:S,deps:[[m,new o.Optional,new o.SkipSelf]]}]}},e}();C.decorators=[{type:o.NgModule,args:[{declarations:p(D),exports:p(D),imports:[],entryComponents:[x]}]}],e.FileItem=s,e.HttpClientUploadService=f,e.NgxUploadModule=C,e.ɵa=g,e.ɵb=m,e.ɵc=y,e.ɵd=v,e.ɵe=P,e.ɵf=O,e.ɵg=S,e.ɵh=u,e.ɵi=I,e.ɵj=w,e.ɵk=x,e.ɵl=E,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=wkoza-ngx-upload.umd.min.js.map